# üá∫üá¶ –°–∏—Å—Ç–µ–º–∞ —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ –ø–æ–≤—ñ—Ç—Ä—è–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏ —Ç–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó

## üìã –û–≥–ª—è–¥

–¶–µ–π –ø—Ä–æ—î–∫—Ç –º—ñ—Å—Ç–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—É —Å–∏—Å—Ç–µ–º—É –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ç–∞ —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ:
- üö® –ü–æ–≤—ñ—Ç—Ä—è–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏ –≤ –£–∫—Ä–∞—ó–Ω—ñ
- ‚ö° –ì—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –∑–≤—ñ—Ç–Ω—ñ—Å—Ç—å

–í—Å—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è —É Telegram.

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –°–µ—Ä–≤—ñ—Å–∏

#### 1. **TelegramService** (`app/Services/TelegramService.php`)
–£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤—ñ—Å –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Telegram Bot API.

**–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**
- ‚úâÔ∏è –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (HTML/Markdown)
- üì∏ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ –∑ –ø—ñ–¥–ø–∏—Å–∞–º–∏
- üìÑ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- üîÑ –î—É–±–ª—é–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—É
- üìù –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** [telegram-service-guide.md](telegram-service-guide.md)

#### 2. **AirAlertService** (`app/Services/AirAlertService.php`)
–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ API alerts.in.ua –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥.

**–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**
- üåç –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –≤—Å—ñ—Ö —Ä–µ–≥—ñ–æ–Ω—ñ–≤
- üìç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–≥—ñ–æ–Ω—É
- üìú –Ü—Å—Ç–æ—Ä—ñ—è —Ç—Ä–∏–≤–æ–≥
- üóÇÔ∏è –°–ø–∏—Å–æ–∫ —Ä–µ–≥—ñ–æ–Ω—ñ–≤

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** [air-alert-service-guide.md](air-alert-service-guide.md)

#### 3. **PowerOutageImageGenerator** (`app/Services/PowerOutageImageGenerator.php`)
–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≥—Ä–∞—Ñ—ñ—á–Ω–∏—Ö –∑–æ–±—Ä–∞–∂–µ–Ω—å –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å.

### Jobs (–ß–µ—Ä–≥–∏)

#### 1. **SendPowerOutageNotification**
–í—ñ–¥–ø—Ä–∞–≤–ª—è—î –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó —É –≤–∏–≥–ª—è–¥—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```php
SendPowerOutageNotification::dispatch($schedule);
```

#### 2. **SendAirAlertNotification**
–í—ñ–¥–ø—Ä–∞–≤–ª—è—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–≤—ñ—Ç—Ä—è–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏.

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```php
SendAirAlertNotification::dispatch(
    region: '–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    isActive: true,
    additionalInfo: '–ó–∞–≥—Ä–æ–∑–∞ —Ä–∞–∫–µ—Ç–Ω–æ–≥–æ —É–¥–∞—Ä—É'
);
```

### Artisan Commands

#### 1. **air-alert:monitor**
–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ.

```bash
# –í—Å—ñ —Ä–µ–≥—ñ–æ–Ω–∏
php artisan air-alert:monitor

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ä–µ–≥—ñ–æ–Ω
php artisan air-alert:monitor --region=25
```

#### 2. **air-alert:daily-report**
–©–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç –ø—Ä–æ —Ç—Ä–∏–≤–æ–≥–∏.

```bash
# –ü–æ –≤—Å—ñ–π –£–∫—Ä–∞—ó–Ω—ñ
php artisan air-alert:daily-report

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ä–µ–≥—ñ–æ–Ω
php artisan air-alert:daily-report --region=25
```

### –ú–æ–¥–µ–ª—ñ

#### AirAlert (`app/Models/AirAlert.php`)
–ú–æ–¥–µ–ª—å –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥.

**–ü–æ–ª—è:**
- `region_id` - ID —Ä–µ–≥—ñ–æ–Ω—É
- `region_name` - –ù–∞–∑–≤–∞ —Ä–µ–≥—ñ–æ–Ω—É
- `is_active` - –°—Ç–∞—Ç—É—Å (–∞–∫—Ç–∏–≤–Ω–∞/–∑–∞–∫—ñ–Ω—á–µ–Ω–∞)
- `alert_type` - –¢–∏–ø —Ç—Ä–∏–≤–æ–≥–∏
- `started_at` - –ß–∞—Å –ø–æ—á–∞—Ç–∫—É
- `ended_at` - –ß–∞—Å –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è
- `duration_minutes` - –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å

**Scopes:**
```php
// –ê–∫—Ç–∏–≤–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏
AirAlert::active()->get();

// –Ü—Å—Ç–æ—Ä—ñ—è —Ä–µ–≥—ñ–æ–Ω—É
AirAlert::forRegion('25')->get();
```

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–î–æ–¥–∞–π—Ç–µ —É `.env`:

```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here

# Air Alert API
AIR_ALERT_API_TOKEN=8a0343dfa946b66b0b4c7b6e6c1f867076ea1a74ab2203
```

### 2. –ó–∞–ø—É—Å–∫ –º—ñ–≥—Ä–∞—Ü—ñ–π

```bash
php artisan migrate
```

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

–î–æ–¥–∞–π—Ç–µ —É `routes/console.php`:

```php
use Illuminate\Support\Facades\Schedule;

// –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∏–≤–æ–≥ –∫–æ–∂–Ω—ñ 2 —Ö–≤–∏–ª–∏–Ω–∏
Schedule::command('air-alert:monitor')
    ->everyTwoMinutes()
    ->withoutOverlapping()
    ->runInBackground();

// –©–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç –æ 20:00
Schedule::command('air-alert:daily-report')
    ->dailyAt('20:00')
    ->runInBackground();
```

### 4. –ó–∞–ø—É—Å–∫ scheduler

```bash
# –£ crontab
* * * * * cd /path-to-project && php artisan schedule:run >> /dev/null 2>&1
```

## üìä –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É Telegram

```php
use App\Services\TelegramService;

$telegram = new TelegramService();
$telegram->sendMessage('üö® <b>–í–∞–∂–ª–∏–≤–æ!</b> –¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è');
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—Ä–∏–≤–æ–≥–∏

```php
use App\Services\AirAlertService;

$airAlert = new AirAlertService();

if ($airAlert->isAlertActive('31')) {  // –º. –ö–∏—ó–≤
    echo '–¢—Ä–∏–≤–æ–≥–∞ —É –ö–∏—î–≤—ñ!';
}
```

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —Ç—Ä–∏–≤–æ–≥

```php
use App\Models\AirAlert;

// –í—Å—ñ —Ç—Ä–∏–≤–æ–≥–∏ –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
$todayAlerts = AirAlert::whereDate('started_at', today())->get();

// –¢—Ä–∏–≤–æ–≥–∏ –¥–ª—è –ö–∏—î–≤–∞ –∑–∞ —Ç–∏–∂–¥–µ–Ω—å
$kyivAlerts = AirAlert::forRegion('31')
    ->whereBetween('started_at', [now()->subWeek(), now()])
    ->get();

// –°–µ—Ä–µ–¥–Ω—è —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å
$avgDuration = AirAlert::avg('duration_minutes');
```

### –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≥—Ä–∞—Ñ—ñ–∫–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å

```php
use App\Jobs\SendPowerOutageNotification;

$schedule = PowerOutageSchedule::find(1);
SendPowerOutageNotification::dispatch($schedule);
```

## üó∫Ô∏è ID –†–µ–≥—ñ–æ–Ω—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏

| UID | –†–µ–≥—ñ–æ–Ω |
|-----|--------|
| 31 | –º. –ö–∏—ó–≤ |
| 14 | –ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å |
| 27 | –õ—å–≤—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å |
| 9 | –î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å |
| 22 | –•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å |
| 18 | –û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å |
| 28 | –î–æ–Ω–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å |
| 16 | –õ—É–≥–∞–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å |

[–ü–æ–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è —Ä–µ–≥—ñ–æ–Ω—ñ–≤ ‚Üí](https://devs.alerts.in.ua/)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- üìñ [TelegramService Guide](telegram-service-guide.md) - –†–æ–±–æ—Ç–∞ –∑ Telegram Bot API
- üìñ [Air Alert Service Guide](air-alert-service-guide.md) - –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥
- üìñ [Power Outage Guide](power-outage-guide.md) - –ì—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å (—è–∫—â–æ —î)

## üîß –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç Telegram Bot

```bash
php artisan tinker
```

```php
$telegram = new \App\Services\TelegramService();
$telegram->sendMessage('üß™ –¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è');
```

### –¢–µ—Å—Ç Air Alert API

```bash
php artisan tinker
```

```php
$airAlert = new \App\Services\AirAlertService();
$alerts = $airAlert->getActiveAlerts();
dd($alerts);
```

### –¢–µ—Å—Ç –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

```bash
# –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π –∑–∞–ø—É—Å–∫
php artisan air-alert:monitor

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–≥—ñ–æ–Ω—É
php artisan air-alert:monitor --region=31  # –ö–∏—ó–≤
```

## üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ –¢–æ–∫–µ–Ω–∏ —Ç—ñ–ª—å–∫–∏ —É `.env`
- ‚úÖ –ù—ñ–∫–æ–ª–∏ –Ω–µ commit–∏–º–æ —Å–µ–∫—Ä–µ—Ç–∏ –≤ git
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ HTTPS –¥–ª—è API
- ‚úÖ –õ–æ–≥—É—î–º–æ –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- ‚úÖ –û–±–º–µ–∂—É—î–º–æ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞

## üìà –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

–í—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è —É `storage/logs/laravel.log`:

```
[2025-11-11 10:30:45] INFO: Telegram message sent {"chat_id":"123456789"}
[2025-11-11 10:31:00] INFO: Air alert status changed {"region":"–ö–∏—ó–≤","status":"active"}
```

## ü§ù –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–ª—è –ø–∏—Ç–∞–Ω—å —Ç–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—å –¥–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø—Ä–æ—î–∫—Ç—É.

## üìù –õ—ñ—Ü–µ–Ω–∑—ñ—è

–¶–µ–π –ø—Ä–æ—î–∫—Ç —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –£–∫—Ä–∞—ó–Ω–∏ üá∫üá¶

