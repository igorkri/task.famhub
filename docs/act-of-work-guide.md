# Керівництво по роботі з Актами робіт

## Огляд

Система управління актами робіт (Act of Work) дозволяє вести облік виконаних робіт, їх вартості та деталей. Кожен акт може містити багато деталей робіт з інформацією про проекти, завдання, години та суми.

## Структура даних

### ActOfWork (Акт робіт)

Основна таблиця для зберігання актів робіт:

- **number** - Номер акту (унікальний)
- **status** - Статус акту:
  - `pending` - В очікуванні
  - `processing` - В обробці
  - `done` - Виконано
  - `cancelled` - Скасовано
- **type** - Тип запису:
  - `act` - Акт
  - `income` - Надходження
  - `new_project` - Новий проєкт
- **user_id** - ID користувача, який створив акт
- **date** - Дата складання акту
- **period_type** - Тип періоду (day, week, month, quarter, year)
- **period_year** - Рік періоду
- **period_month** - Місяць періоду
- **total_amount** - Загальна сума
- **paid_amount** - Сума, вже сплачена
- **description** - Опис робіт
- **file_excel** - Посилання на файл Excel
- **telegram_status** - Статус відправки в Telegram (pending, send, error)
- **sort** - Порядок сортування

### ActOfWorkDetail (Деталі акту робіт)

Таблиця для зберігання деталей кожного акту:

- **act_of_work_id** - ID акту робіт (зв'язок з ActOfWork)
- **time_id** - ID запису часу
- **task_gid** - ID завдання з Asana
- **project_gid** - ID проекту з Asana
- **project** - Назва проекту
- **task** - Назва завдання
- **description** - Опис роботи
- **amount** - Сума за роботу
- **hours** - Кількість годин

## Використання в Filament

### Доступ до модуля

1. Увійдіть в адмін-панель: `/admin`
2. В навігації знайдіть пункт "Акти робіт"

### Список актів робіт

На сторінці списку ви можете:
- Переглянути всі акти робіт у табличному вигляді
- Використовувати фільтри:
  - За статусом
  - За типом запису
  - За користувачем
  - За періодом
  - За статусом Telegram
- Сортувати за різними полями
- Шукати за номером акту

### Створення нового акту

1. Натисніть кнопку "Створити" на сторінці списку
2. Заповніть основну інформацію:
   - Номер акту (генерується автоматично)
   - Статус
   - Користувач
   - Дата
   - Тип запису
   - Період
   - Суми
   - Опис
3. Додайте деталі робіт через Repeater:
   - Проект та завдання
   - Сума та години
   - Опис роботи
4. Збережіть акт

### Редагування акту

1. Натисніть на іконку редагування у рядку акту
2. Внесіть необхідні зміни
3. Збережіть зміни

### Перегляд деталей акту

1. Натисніть на іконку перегляду у рядку акту
2. Переглядайте всю інформацію про акт та його деталі

## Імпорт даних

### Імпорт з SQL дампа

Для імпорту даних з старої системи використовуйте команду:

```bash
php artisan app:import-act-of-work
```

За замовчуванням імпортуються дані з файлу `storage/old-asana.sql`.

Щоб імпортувати з іншого файлу:

```bash
php artisan app:import-act-of-work --file=path/to/your/file.sql
```

Команда імпортує:
- Всі акти робіт з таблиці `act_of_work`
- Всі деталі робіт з таблиці `act_of_work_detail`

## API та моделі

### Використання моделей в коді

```php
use App\Models\ActOfWork;
use App\Models\ActOfWorkDetail;

// Створення нового акту
$act = ActOfWork::create([
    'number' => time(),
    'status' => 'pending',
    'user_id' => auth()->id(),
    'date' => now(),
    'total_amount' => 1000.00,
    'paid_amount' => 0,
    'type' => 'act',
]);

// Додавання деталей
$act->details()->create([
    'project' => 'Назва проекту',
    'task' => 'Назва завдання',
    'amount' => 500.00,
    'hours' => 5.00,
]);

// Отримання актів користувача
$userActs = ActOfWork::where('user_id', $userId)
    ->with('details')
    ->get();

// Підрахунок загальної суми
$totalAmount = ActOfWork::where('status', 'done')
    ->sum('total_amount');
```

### Відношення моделей

```php
// ActOfWork
$act->user; // Користувач, який створив акт
$act->details; // Колекція деталей акту

// ActOfWorkDetail
$detail->actOfWork; // Батьківський акт
```

## Статистика

Після імпорту в системі:
- **23 акти робіт**
- **223 деталі робіт**

## Поради

1. **Автоматична генерація номерів**: При створенні нового акту номер генерується автоматично на основі timestamp
2. **Зв'язок з користувачами**: Кожен акт прив'язаний до користувача системи
3. **Деталізація робіт**: Використовуйте Repeater для додавання декількох робіт в один акт
4. **Фільтрація**: Використовуйте фільтри для швидкого пошуку потрібних актів
5. **Експорт**: Можливість завантаження Excel файлів для звітності

## Безпека

- Доступ до модуля контролюється системою прав Filament Shield
- Всі дії логуються в системі
- Дані валідуються перед збереженням

## Підтримка

При виникненні питань або проблем зверніться до технічної підтримки.

