# –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ - –ò—Ç–æ–≥–∏

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `power_outage_schedules`
- ‚úÖ –ü–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞—Ç—ã, –æ–ø–∏—Å–∞–Ω–∏—è, –ø–µ—Ä–∏–æ–¥–æ–≤, –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### 2. –ú–æ–¥–µ–ª—å –∏ —Ñ–∞–±—Ä–∏–∫–∞
- ‚úÖ –ú–æ–¥–µ–ª—å `PowerOutageSchedule` —Å casts
- ‚úÖ –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Fillable –ø–æ–ª—è –∏ timestamps

### 3. –ü–∞—Ä—Å–∏–Ω–≥ HTML
- ‚úÖ –°–µ—Ä–≤–∏—Å `PowerOutageParserService`
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –ø–µ—Ä–∏–æ–¥–æ–≤ (–≤—Ä–µ–º—è + –æ–±—ä–µ–º —á–µ—Ä–≥)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ –æ—á–µ—Ä–µ–¥—è–º
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ (on/off/maybe)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MD5 —Ö–µ—à–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 4. Artisan –∫–æ–º–∞–Ω–¥–∞
- ‚úÖ `php artisan power:fetch-schedule [date]`
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ HTTP POST
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ hash
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- ‚úÖ Dispatch Job –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### 5. Job –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
- ‚úÖ `SendPowerOutageNotification` Job
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å emoji
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram Bot API
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–¥—Å—á–µ—Ç —á–∞—Å–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π –ø–æ –æ—á–µ—Ä–µ–¥—è–º

### 6. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Laravel Scheduler
- ‚úÖ –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –ó–∞–ø—É—Å–∫ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (onOneServer)

### 7. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –≤ `config/services.php`
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–æ–∫–µ–Ω–∞ –∏ chat_id

### 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ 7 unit/feature —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
- ‚úÖ –¢–µ—Å—Ç—ã –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ hash
- ‚úÖ –¢–µ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

### 9. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ `docs/power-outage/monitor.md`
- ‚úÖ –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ `docs/power-outage/README.md`
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç `docs/power-outage/QUICKSTART.md`
- ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–æ–º–∞–Ω–¥ `docs/power-outage/COMMANDS.md`
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –≤ –ø–∞–ø–∫–µ `scripts/`

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 9
- **–§–∞–π–ª–æ–≤ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ:** 2
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~800
- **–¢–µ—Å—Ç–æ–≤:** 7 (22 assertions)
- **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ~30 –º–∏–Ω—É—Ç

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
app/
‚îú‚îÄ‚îÄ Console/Commands/FetchPowerOutageSchedule.php
‚îú‚îÄ‚îÄ Jobs/SendPowerOutageNotification.php
‚îú‚îÄ‚îÄ Models/PowerOutageSchedule.php
‚îî‚îÄ‚îÄ Services/PowerOutageParserService.php

database/
‚îú‚îÄ‚îÄ factories/PowerOutageScheduleFactory.php
‚îî‚îÄ‚îÄ migrations/2025_11_09_142952_create_power_outage_schedules_table.php

tests/Feature/
‚îî‚îÄ‚îÄ PowerOutageScheduleTest.php

docs/power-outage/
‚îú‚îÄ‚îÄ INDEX.md
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ QUICKSTART.md
‚îú‚îÄ‚îÄ monitor.md
‚îú‚îÄ‚îÄ COMMANDS.md
‚îú‚îÄ‚îÄ SUMMARY.md
‚îî‚îÄ‚îÄ CHANGELOG.md

scripts/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ setup-telegram.sh
‚îî‚îÄ‚îÄ test-power-outage.sh
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ)

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞:
   ```bash
   # –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
   # –î–æ–±–∞–≤–∏—Ç—å –≤ .env:
   TELEGRAM_BOT_TOKEN=your_token
   TELEGRAM_CHAT_ID=your_chat_id
   ```

2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron:
   ```bash
   * * * * * cd /path/to/project && php artisan schedule:run >> /dev/null 2>&1
   ```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
./scripts/test-power-outage.sh

# –†—É—á–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
php artisan power:fetch-schedule

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –¥–∞—Ç—É
php artisan power:fetch-schedule 10-11-2025

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
php artisan test --filter=PowerOutageScheduleTest

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f storage/logs/laravel.log | grep -i power
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø

```php
use App\Models\PowerOutageSchedule;

// –ü–æ—Å–ª–µ–¥–Ω–∏–π –≥—Ä–∞—Ñ–∏–∫
$schedule = PowerOutageSchedule::latest('fetched_at')->first();

// –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
echo "–î–∞—Ç–∞: " . $schedule->schedule_date->format('d.m.Y');
echo "–ü–µ—Ä–∏–æ–¥–æ–≤: " . count($schedule->periods);
echo "–û—á–µ—Ä–µ–¥–µ–π: " . count($schedule->schedule_data);

// –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
foreach ($schedule->schedule_data as $row) {
    $offHours = count(array_filter($row['hourly_status'], fn($s) => $s === 'off')) / 2;
    echo "{$row['queue']}.{$row['subqueue']}: {$offHours}—á\n";
}
```

## üìà –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

1. **–î–∞—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞** - –Ω–∞ –∫–∞–∫—É—é –¥–∞—Ç—É —Å–æ—Å—Ç–∞–≤–ª–µ–Ω –≥—Ä–∞—Ñ–∏–∫
2. **–ü–µ—Ä–∏–æ–¥—ã** - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∏ –æ–±—ä–µ–º —á–µ—Ä–≥
3. **–î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ** - —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ –ø–æ–ª—á–∞—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥—á–µ—Ä–≥–∏
4. **–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è** - –∫–æ–≥–¥–∞ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ
5. **–•–µ—à –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram —Å:
- –î–∞—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫–∞
- –û–ø–∏—Å–∞–Ω–∏–µ–º —Å–∏—Ç—É–∞—Ü–∏–∏
- –ü–µ—Ä–∏–æ–¥–∞–º–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π
- –°–≤–æ–¥–∫–æ–π –ø–æ –æ—á–µ—Ä–µ–¥—è–º

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ hash
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –¥–∞—Ç–∞—Ö
- **–ò—Å—Ç–æ—Ä–∏—è:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥–∞ HTML –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
- ‚úÖ –ê–Ω–∞–ª–∏–∑–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π

–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ

