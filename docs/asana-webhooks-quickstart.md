# üéØ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç: WebHooks Asana

## ‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û: –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω ngrok?

| –°–∏—Ç—É–∞—Ü—ñ—è | ngrok/localtunnel | –†—ñ—à–µ–Ω–Ω—è |
|----------|------------------|---------|
| üè† **–õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞** (task.famhub.local) | ‚úÖ **–ü–û–¢–†–Ü–ë–ï–ù** | –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ localtunnel –∞–±–æ ngrok |
| üåê **Production** (—Ä–µ–∞–ª—å–Ω–∏–π –¥–æ–º–µ–Ω –∑ HTTPS) | ‚ùå **–ù–ï –ü–û–¢–†–Ü–ë–ï–ù** | –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ APP_URL |
| üîß **Staging** (–ø—É–±–ª—ñ—á–Ω–∏–π —Å–µ—Ä–≤–µ—Ä) | ‚ùå **–ù–ï –ü–û–¢–†–Ü–ë–ï–ù** | –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ APP_URL |

---

## üöÄ –í–ò–ë–Ü–† –°–¶–ï–ù–ê–†–Ü–Æ

### üìò –°—Ü–µ–Ω–∞—Ä—ñ–π –ê: Production (–†–µ–∞–ª—å–Ω–∏–π –¥–æ–º–µ–Ω)

**–Ø–∫—â–æ —É –≤–∞—Å –≤–∂–µ —î –ø—É–±–ª—ñ—á–Ω–∏–π –¥–æ–º–µ–Ω –∑ HTTPS:**

üëâ **–ß–∏—Ç–∞–π—Ç–µ:** [docs/asana-webhooks-production.md](./asana-webhooks-production.md)

**–ö–æ—Ä–æ—Ç–∫–æ:**
```bash
# 1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å queue worker
php artisan queue:work

# 2. –°—Ç–≤–æ—Ä—ñ—Ç—å webhook (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î APP_URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
php artisan asana:webhooks create --resource=PROJECT_GID

# 3. –ì–æ—Ç–æ–≤–æ! ‚úÖ
```

---

### üìó –°—Ü–µ–Ω–∞—Ä—ñ–π –ë: –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ (–±–µ–∑ –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É)

**–Ø–∫—â–æ —Ä–æ–∑—Ä–æ–±–ª—è—î—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ (task.famhub.local):**

üëâ **–ß–∏—Ç–∞–π—Ç–µ:** [docs/asana-webhooks-ngrok.md](./asana-webhooks-ngrok.md)

**–ö–æ—Ä–æ—Ç–∫–æ:**
```bash
# 1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –ª–æ–∫–∞–ª—å–Ω–∏–π —Ç—É–Ω–µ–ª—å (–æ–¥–∏–Ω —Ä–∞–∑)
npm install -g localtunnel

# 2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ç—É–Ω–µ–ª—å (–¢–µ—Ä–º—ñ–Ω–∞–ª 1)
lt --port 80
# –°–∫–æ–ø—ñ—é–π—Ç–µ HTTPS URL

# 3. Queue worker (–¢–µ—Ä–º—ñ–Ω–∞–ª 2)
php artisan queue:work

# 4. –°—Ç–≤–æ—Ä—ñ—Ç—å webhook –∑ —Ç—É–Ω–µ–ª—å URL (–¢–µ—Ä–º—ñ–Ω–∞–ª 3)
php artisan asana:webhooks create \
  --resource=PROJECT_GID \
  --url=https://YOUR-TUNNEL-URL.loca.lt/api/webhooks/asana
```

---

### 1Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

```bash
php artisan tinker
>>> config('app.url')  // –ú–∞—î –±—É—Ç–∏ https://your-domain.com
```

### 2Ô∏è‚É£ –°—Ç–≤–æ—Ä—ñ—Ç—å webhooks –¥–ª—è production

```bash
php artisan asana:webhooks create \
  --resource=PROJECT_GID
  # --url –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î APP_URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
```

### 3Ô∏è‚É£ –ù–∞–ª–∞—à—Ç—É–π—Ç–µ supervisor –¥–ª—è queue worker

```ini
[program:laravel-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/artisan queue:work --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/path/to/storage/logs/worker.log
stopwaitsecs=3600
```

## üîç –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∫–æ–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –ø–æ–¥—ñ—è

1. **Asana –Ω–∞–¥—Å–∏–ª–∞—î POST** –Ω–∞ `/api/webhooks/asana`
2. **–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä —à–≤–∏–¥–∫–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î** 200 OK (–≤–∞–∂–ª–∏–≤–æ –¥–ª—è Asana!)
3. **Job –¥–æ–¥–∞—î—Ç—å—Å—è –≤ —á–µ—Ä–≥—É** `ProcessAsanaWebhookJob`
4. **Queue worker –æ–±—Ä–æ–±–ª—è—î** –ø–æ–¥—ñ—é:
   - –î–ª—è **tasks**: —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –∑ Asana (create/update/delete)
   - –î–ª—è **stories**: —Å—Ç–≤–æ—Ä—é—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ
   - –î–ª—è **projects/sections**: –ª–æ–≥—É—î –ø–æ–¥—ñ—ó
5. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è** –≤ —Ç–∞–±–ª–∏—Ü—ñ `asana_webhooks`

## üéâ –ü–µ—Ä–µ–≤–∞–≥–∏ WebHooks

- ‚ö° **Real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –∑–º—ñ–Ω–∏ –∑'—è–≤–ª—è—é—Ç—å—Å—è –º–∏—Ç—Ç—î–≤–æ
- üìâ **–ú–µ–Ω—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ API** - –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ—Å—Ç—ñ–π–Ω–æ –æ–ø–∏—Ç—É–≤–∞—Ç–∏
- üéØ **–¢–æ—á–Ω—ñ—Å—Ç—å** - –æ—Ç—Ä–∏–º—É—î—Ç–µ —Ç—ñ–ª—å–∫–∏ —Ä–µ–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏
- üîÑ **–î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –ø—Ä–∞—Ü—é—î —Ä–∞–∑–æ–º –∑ —ñ—Å–Ω—É—é—á–æ—é —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é

## üìö –î–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è: [docs/asana-webhooks-guide.md](./asana-webhooks-guide.md)

–¢–∞–º –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ:
- –ü–æ–≤–Ω–∏–π –æ–ø–∏—Å –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ –ø–æ–¥—ñ–π
- Troubleshooting
- –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- Production deployment
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è

## üêõ Troubleshooting

### Webhook –Ω–µ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ URL –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É (–¥–ª—è dev: ngrok)
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ ASANA_TOKEN

### –ü–æ–¥—ñ—ó –Ω–µ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è
- –ó–∞–ø—É—Å—Ç—ñ—Ç—å `php artisan queue:work`
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏: `tail -f storage/logs/laravel.log`

### Webhook –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π
–í–∏–¥–∞–ª—ñ—Ç—å —ñ —Å—Ç–≤–æ—Ä—ñ—Ç—å –∑–Ω–æ–≤—É:
```bash
php artisan asana:webhooks delete --webhook=GID
php artisan asana:webhooks create --resource=PROJECT_GID
```

## üéä –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä –≤–∞—à—ñ —Ç–∞—Å–∫–∏ –±—É–¥—É—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏—Å—è –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö –≤ Asana! üöÄ
