# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Asana

## üìã –û–≥–ª—è–¥

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∞—Ü—é—î –Ω–∞ **–¥–≤–æ—Ö —Ä—ñ–≤–Ω—è—Ö**:

1. **Webhooks (–æ—Å–Ω–æ–≤–Ω–∏–π –º–µ—Ç–æ–¥)** - –º–∏—Ç—Ç—î–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö –≤ Asana
2. **Cron (—Ä–µ–∑–µ—Ä–≤–Ω–∏–π –º–µ—Ç–æ–¥)** - –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –¥–∞–Ω–∏—Ö

---

## üîÑ 1. –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Webhooks

### –Ø–∫ –ø—Ä–∞—Ü—é—î:

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** - –ø—Ä–∏ –±—É–¥—å-—è–∫–∏—Ö –∑–º—ñ–Ω–∞—Ö –≤ Asana
- ‚ö° **–ú–∏—Ç—Ç—î–≤–æ** - webhook —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –∑–∞ ~1-2 —Å–µ–∫—É–Ω–¥–∏
- üì¶ **–©–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î—Ç—å—Å—è:**
  - –ù–∞–∑–≤–∞ –∑–∞–¥–∞—á—ñ
  - –û–ø–∏—Å
  - –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å
  - –°—Ç–∞—Ç—É—Å (completed/active)
  - –î–µ–¥–ª–∞–π–Ω —ñ –¥–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É
  - **–í—Å—ñ –∫–∞—Å—Ç–æ–º–Ω—ñ –ø–æ–ª—è** (–≤–∫–ª—é—á–∞—é—á–∏ —á–∞—Å, –±—é–¥–∂–µ—Ç, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)
  - –ü—Ä–æ–µ–∫—Ç —ñ —Å–µ–∫—Ü—ñ—è
  - –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ (stories)

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:

Webhooks –≤–∂–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ! URL: `https://your-domain.com/api/webhooks/asana`

**–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ webhooks:**
```bash
php artisan asana:webhooks list
```

**–°—Ç–≤–æ—Ä–∏—Ç–∏ webhooks –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤:**
```bash
php artisan asana:webhooks:create-all
```

**–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ webhooks:**
```bash
php artisan asana:webhooks delete-all
```

### –û–±—Ä–æ–±–∫–∞:

1. Webhook –Ω–∞–¥—Ö–æ–¥–∏—Ç—å –Ω–∞ `/api/webhooks/asana`
2. `AsanaWebhookController` –ø—Ä–∏–π–º–∞—î –∑–∞–ø–∏—Ç —ñ –ø–æ–≤–µ—Ä—Ç–∞—î 200 OK
3. Job `ProcessAsanaWebhookJob` –æ–±—Ä–æ–±–ª—è—î –ø–æ–¥—ñ—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ —á–µ—Ä–≥—É
4. –î–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É –ë–î

---

## ‚è∞ 2. –†–µ–∑–µ—Ä–≤–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Cron

### –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞:

- üõ°Ô∏è **–†–µ–∑–µ—Ä–≤–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º** - –Ω–∞ –≤–∏–ø–∞–¥–æ–∫, —è–∫—â–æ webhook –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤
- üîß **–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∑–±–æ—ó–≤** - —è–∫—â–æ —Å–µ—Ä–≤–µ—Ä –±—É–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π
- üìä **–ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞** - –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö

### –Ø–∫ –ø—Ä–∞—Ü—é—î:

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** (—á–µ—Ä–µ–∑ Laravel Scheduler):
- –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è **–∫–æ–∂–Ω—ñ 6 –≥–æ–¥–∏–Ω**
- –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –∑–∞–¥–∞—á—ñ, —è–∫—ñ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–ª–∏—Å—è –æ—Å—Ç–∞–Ω–Ω—ñ 6 –≥–æ–¥–∏–Ω
- –ú–∞–∫—Å–∏–º—É–º 100 –∑–∞–¥–∞—á –∑–∞ —Ä–∞–∑
- –ü—Ä–∞—Ü—é—î —É —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ

**–í—Ä—É—á–Ω—É** (–¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∞–±–æ –º–∞—Å–æ–≤–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó):

```bash
# –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–¥–∞—á—ñ, —è–∫—ñ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–ª–∏—Å—è 24 –≥–æ–¥–∏–Ω–∏
php artisan asana:sync-tasks

# –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–¥–∞—á—ñ, —è–∫—ñ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–ª–∏—Å—è 12 –≥–æ–¥–∏–Ω
php artisan asana:sync-tasks --hours=12

# –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ –∑–∞–¥–∞—á (–¥–æ 200)
php artisan asana:sync-tasks --limit=200

# FORCE —Ä–µ–∂–∏–º - —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –í–°–Ü –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω—ñ –∑–∞–¥–∞—á—ñ
php artisan asana:sync-tasks --force --limit=500
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Cron:

Laravel Scheduler –≤–∂–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π —É `routes/console.php`:

```php
Schedule::command('asana:sync-tasks --hours=6 --limit=100')
    ->everySixHours()
    ->withoutOverlapping()
    ->onOneServer()
    ->runInBackground();
```

**–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∫—Ä–æ–Ω –∑–∞–ø—É—â–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ:**

```bash
crontab -e
```

–î–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫ –¥–ª—è production:
```
* * * * * /usr/bin/php8.4 /home/igor/web/task.dev2025.ingsot.com/public_html/task.famhub/artisan schedule:run >> /dev/null 2>&1
```

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏:
```
* * * * * cd /home/igor/developer/task.famhub.local && php artisan schedule:run >> /dev/null 2>&1
```

–ê–±–æ –¥–ª—è Docker/Sail:
```
* * * * * cd /path-to-your-project && ./vendor/bin/sail artisan schedule:run >> /dev/null 2>&1
```

---

## üéØ –©–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

### ‚úÖ –ó–∞–≤–∂–¥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î—Ç—å—Å—è (—á–µ—Ä–µ–∑ webhooks):

| –ü–æ–ª–µ | –û–ø–∏—Å |
|------|------|
| **–ù–∞–∑–≤–∞** | title |
| **–û–ø–∏—Å** | description |
| **–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å** | user_id |
| **–°—Ç–∞—Ç—É—Å** | is_completed, status (–Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å–µ–∫—Ü—ñ—ó) |
| **–î–µ–¥–ª–∞–π–Ω** | deadline (due_on) |
| **–î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É** | start_date (start_on) |
| **–ö–∞—Å—Ç–æ–º–Ω—ñ –ø–æ–ª—è** | –í—Å—ñ (text, number, date, enum) |
| **–ü—Ä–æ–µ–∫—Ç** | project_id |
| **–°–µ–∫—Ü—ñ—è** | section_id |
| **–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ** | stories (–∑ —Ç–∏–ø–æ–º comment) |

### üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö:

- **Enum GID** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç—É—î—Ç—å—Å—è —É string
- **–ß–∏—Å–ª–æ–≤—ñ –ø–æ–ª—è** - –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —è–∫ —Ü—ñ–ª—ñ —á–∏—Å–ª–∞ (—Ö–≤–∏–ª–∏–Ω–∏)
- **–î–∞—Ç–∏** - –∫–æ–Ω–≤–µ—Ä—Ç—É—é—Ç—å—Å—è —É —Ñ–æ—Ä–º–∞—Ç Y-m-d

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É webhooks:

1. –ó–º—ñ–Ω—ñ—Ç—å –∑–∞–¥–∞—á—É –≤ Asana
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
```bash
tail -f storage/logs/laravel.log | grep "Asana webhook"
```

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–µ—Ä–≥—É:
```bash
php artisan queue:work --verbose
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é:

```bash
# –¢–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø—É—Å–∫ –∑ –≤–∏–≤–æ–¥–æ–º –ø—Ä–æ–≥—Ä–µ—Å—É
php artisan asana:sync-tasks --hours=24 --limit=10
```

---

## üõ†Ô∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–≥

–î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ webhooks –ø–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ —á–µ—Ä–≥–∞:

### –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞:

```bash
php artisan queue:work --verbose
```

### –ü—Ä–æ–¥–∞–∫—à–Ω (Supervisor):

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `/etc/supervisor/conf.d/laravel-task-worker.conf`:

```ini
[program:laravel-task-worker]
process_name=%(program_name)s_%(process_num)02d
command=/usr/bin/php8.4 /home/igor/web/task.dev2025.ingsot.com/public_html/task.famhub/artisan queue:work --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/home/igor/web/task.dev2025.ingsot.com/public_html/task.famhub/storage/logs/worker.log
stopwaitsecs=3600
```

**–ö–µ—Ä—É–≤–∞–Ω–Ω—è Supervisor:**

```bash
# –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
sudo supervisorctl reread
sudo supervisorctl update

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ worker
sudo supervisorctl start laravel-task-worker:*

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ worker
sudo supervisorctl restart laravel-task-worker:*

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
sudo supervisorctl status laravel-task-worker:*

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
sudo supervisorctl tail -f laravel-task-worker:laravel-task-worker_00 stdout
```

–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Docker/Sail –∑ `docker-compose.yml`.

---

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É webhooks:

```bash
php artisan tinker
```

```php
// –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ webhooks
\App\Models\AsanaWebhook::all();

// –û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–¥—ñ—ó
\App\Models\AsanaWebhook::where('last_success_at', '>', now()->subDay())->get();
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏:

```bash
# –í—Å—ñ –ø–æ–¥—ñ—ó webhooks
tail -100 storage/logs/laravel.log | grep "webhook"

# –ü–æ–º–∏–ª–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
tail -100 storage/logs/laravel.log | grep "ERROR"

# –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –ø–æ–ª—ñ–≤
tail -100 storage/logs/laravel.log | grep "custom fields"
```

---

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

1. **–ß–µ—Ä–≥–∞ –ø–æ–≤–∏–Ω–Ω–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏** - –±–µ–∑ —á–µ—Ä–≥–∏ webhooks –Ω–µ –æ–±—Ä–æ–±–ª—è—Ç–∏–º—É—Ç—å—Å—è
2. **–ö—Ä–æ–Ω –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π** - –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
3. **Webhooks —Å—Ç–≤–æ—Ä–µ–Ω—ñ** - –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É –º–∞—î –±—É—Ç–∏ webhook
4. **Ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏** - Asana –Ω–µ –º–æ–∂–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ webhooks –Ω–∞ localhost

---

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ webhooks:**
```bash
php artisan asana:webhooks list
```

2. **–°—Ç–≤–æ—Ä—ñ—Ç—å webhooks (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ):**
```bash
php artisan asana:webhooks:create-all
```

3. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —á–µ—Ä–≥—É:**
```bash
php artisan queue:work
```

4. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∫—Ä–æ–Ω** (–Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ)

5. **–ì–æ—Ç–æ–≤–æ!** üéâ –¢–µ–ø–µ—Ä –≤—Å—ñ –∑–º—ñ–Ω–∏ –≤ Asana –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è!

---

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- Webhooks –ø—Ä–∞—Ü—é—é—Ç—å **—Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç—ñ–≤ –∑ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–º–∏ webhooks**
- –†–µ–∑–µ—Ä–≤–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–∞—Ü—é—î **–¥–ª—è –≤—Å—ñ—Ö –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö –∑–∞–¥–∞—á**
- –ö–∞—Å—Ç–æ–º–Ω—ñ –ø–æ–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –ø—Ä–∏ –±—É–¥—å-—è–∫—ñ–π –∑–º—ñ–Ω—ñ –∑–∞–¥–∞—á—ñ
- –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–æ–≤–æ—ó –∑–∞–¥–∞—á—ñ –≤ Asana –≤–æ–Ω–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑'—è–≤–ª—è—î—Ç—å—Å—è** –≤ —Å–∏—Å—Ç–µ–º—ñ

